{% extends "base.html" %}

{% block page_title %}Пациенты{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-gray-800">Управление пациентами</h1>
        <div>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#patientModal">
                <i class="fas fa-plus me-2"></i>Новый пациент
            </button>
        </div>
    </div>

    <!-- Фильтры -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Фильтры</h6>
        </div>
        <div class="card-body">
            <form id="filterForm" class="row g-3">
                <div class="col-md-3">
                    <label for="petType" class="form-label">Вид животного</label>
                    <select class="form-select" id="petType">
                        <option value="">Все виды</option>
                        <option value="cat">Кошка</option>
                        <option value="dog">Собака</option>
                        <option value="bird">Птица</option>
                        <option value="rodent">Грызун</option>
                        <option value="exotic">Экзотическое</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="status" class="form-label">Статус</label>
                    <select class="form-select" id="status">
                        <option value="">Все статусы</option>
                        <option value="healthy">Здоров</option>
                        <option value="treatment">На лечении</option>
                        <option value="observation">Под наблюдением</option>
                        <option value="critical">Критическое состояние</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="owner" class="form-label">Владелец</label>
                    <input type="text" class="form-control" id="owner" placeholder="Имя владельца">
                </div>
                <div class="col-md-3">
                    <label for="search" class="form-label">Поиск</label>
                    <input type="text" class="form-control" id="search" placeholder="Кличка питомца">
                </div>
                <div class="col-12 mt-3">
                    <button type="submit" class="btn btn-primary">Применить фильтры</button>
                    <button type="reset" class="btn btn-outline-secondary">Сбросить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Список пациентов -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-primary">Список пациентов</h6>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-outline-primary active" id="viewTable">
                            <i class="fas fa-list"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-primary" id="viewGrid">
                            <i class="fas fa-th"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Табличный вид -->
                    <div id="tableView">
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover" id="patientsTable">
                                <thead>
                                    <tr>
                                        <th>Фото</th>
                                        <th>Кличка</th>
                                        <th>Вид</th>
                                        <th>Владелец</th>
                                        <th>Возраст</th>
                                        <th>Последний визит</th>
                                        <th>Статус</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><img src="https://via.placeholder.com/40" class="rounded-circle" alt="Барсик"></td>
                                        <td>Барсик</td>
                                        <td>Кот</td>
                                        <td>Иван Петров</td>
                                        <td>3 года</td>
                                        <td>15.03.2025</td>
                                        <td><span class="badge bg-success">Здоров</span></td>
                                        <td>
                                            <div class="btn-group">
                                                <button class="btn btn-sm btn-outline-primary"><i class="fas fa-eye"></i></button>
                                                <button class="btn btn-sm btn-outline-secondary"><i class="fas fa-edit"></i></button>
                                                <button class="btn btn-sm btn-outline-info"><i class="fas fa-file-medical"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><img src="https://via.placeholder.com/40" class="rounded-circle" alt="Мурка"></td>
                                        <td>Мурка</td>
                                        <td>Кошка</td>
                                        <td>Анна Сидорова</td>
                                        <td>2 года</td>
                                        <td>18.03.2025</td>
                                        <td><span class="badge bg-warning">На лечении</span></td>
                                        <td>
                                            <div class="btn-group">
                                                <button class="btn btn-sm btn-outline-primary"><i class="fas fa-eye"></i></button>
                                                <button class="btn btn-sm btn-outline-secondary"><i class="fas fa-edit"></i></button>
                                                <button class="btn btn-sm btn-outline-info"><i class="fas fa-file-medical"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><img src="https://via.placeholder.com/40" class="rounded-circle" alt="Рекс"></td>
                                        <td>Рекс</td>
                                        <td>Собака</td>
                                        <td>Алексей Смирнов</td>
                                        <td>5 лет</td>
                                        <td>12.03.2025</td>
                                        <td><span class="badge bg-success">Здоров</span></td>
                                        <td>
                                            <div class="btn-group">
                                                <button class="btn btn-sm btn-outline-primary"><i class="fas fa-eye"></i></button>
                                                <button class="btn btn-sm btn-outline-secondary"><i class="fas fa-edit"></i></button>
                                                <button class="btn btn-sm btn-outline-info"><i class="fas fa-file-medical"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><img src="https://via.placeholder.com/40" class="rounded-circle" alt="Шарик"></td>
                                        <td>Шарик</td>
                                        <td>Собака</td>
                                        <td>Мария Иванова</td>
                                        <td>4 года</td>
                                        <td>20.03.2025</td>
                                        <td><span class="badge bg-danger">Критическое состояние</span></td>
                                        <td>
                                            <div class="btn-group">
                                                <button class="btn btn-sm btn-outline-primary"><i class="fas fa-eye"></i></button>
                                                <button class="btn btn-sm btn-outline-secondary"><i class="fas fa-edit"></i></button>
                                                <button class="btn btn-sm btn-outline-info"><i class="fas fa-file-medical"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Вид сеткой -->
                    <div id="gridView" class="row g-3" style="display: none;">
                        <div class="col-md-4 col-lg-3">
                            <div class="card patient-card h-100">
                                <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Барсик">
                                <div class="card-body">
                                    <h5 class="card-title">Барсик</h5>
                                    <p class="card-text text-muted">Кот, 3 года</p>
                                    <p class="mb-1">Владелец: <strong>Иван Петров</strong></p>
                                    <p class="mb-2">Последний визит: <strong>15.03.2025</strong></p>
                                    <span class="badge bg-success mb-3">Здоров</span>
                                    <div class="d-flex justify-content-between">
                                        <button class="btn btn-sm btn-outline-primary"><i class="fas fa-eye me-1"></i> Просмотр</button>
                                        <button class="btn btn-sm btn-outline-info"><i class="fas fa-file-medical me-1"></i> Медкарта</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-lg-3">
                            <div class="card patient-card h-100">
                                <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Мурка">
                                <div class="card-body">
                                    <h5 class="card-title">Мурка</h5>
                                    <p class="card-text text-muted">Кошка, 2 года</p>
                                    <p class="mb-1">Владелец: <strong>Анна Сидорова</strong></p>
                                    <p class="mb-2">Последний визит: <strong>18.03.2025</strong></p>
                                    <span class="badge bg-warning mb-3">На лечении</span>
                                    <div class="d-flex justify-content-between">
                                        <button class="btn btn-sm btn-outline-primary"><i class="fas fa-eye me-1"></i> Просмотр</button>
                                        <button class="btn btn-sm btn-outline-info"><i class="fas fa-file-medical me-1"></i> Медкарта</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-lg-3">
                            <div class="card patient-card h-100">
                                <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Рекс">
                                <div class="card-body">
                                    <h5 class="card-title">Рекс</h5>
                                    <p class="card-text text-muted">Собака, 5 лет</p>
                                    <p class="mb-1">Владелец: <strong>Алексей Смирнов</strong></p>
                                    <p class="mb-2">Последний визит: <strong>12.03.2025</strong></p>
                                    <span class="badge bg-success mb-3">Здоров</span>
                                    <div class="d-flex justify-content-between">
                                        <button class="btn btn-sm btn-outline-primary"><i class="fas fa-eye me-1"></i> Просмотр</button>
                                        <button class="btn btn-sm btn-outline-info"><i class="fas fa-file-medical me-1"></i> Медкарта</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-lg-3">
                            <div class="card patient-card h-100">
                                <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Шарик">
                                <div class="card-body">
                                    <h5 class="card-title">Шарик</h5>
                                    <p class="card-text text-muted">Собака, 4 года</p>
                                    <p class="mb-1">Владелец: <strong>Мария Иванова</strong></p>
                                    <p class="mb-2">Последний визит: <strong>20.03.2025</strong></p>
                                    <span class="badge bg-danger mb-3">Критическое состояние</span>
                                    <div class="d-flex justify-content-between">
                                        <button class="btn btn-sm btn-outline-primary"><i class="fas fa-eye me-1"></i> Просмотр</button>
                                        <button class="btn btn-sm btn-outline-info"><i class="fas fa-file-medical me-1"></i> Медкарта</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно добавления пациента -->
<div class="modal fade" id="patientModal" tabindex="-1" aria-labelledby="patientModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="patientModalLabel">Новый пациент</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="patientForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="petName" class="form-label">Кличка</label>
                            <input type="text" class="form-control" id="petName" required>
                        </div>
                        <div class="col-md-6">
                            <label for="petTypeSelect" class="form-label">Вид животного</label>
                            <select class="form-select" id="petTypeSelect" required>
                                <option value="">Выберите вид</option>
                                <option value="cat">Кошка</option>
                                <option value="dog">Собака</option>
                                <option value="bird">Птица</option>
                                <option value="rodent">Грызун</option>
                                <option value="exotic">Экзотическое</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="petBreed" class="form-label">Порода</label>
                            <input type="text" class="form-control" id="petBreed">
                        </div>
                        <div class="col-md-6">
                            <label for="petBirthdate" class="form-label">Дата рождения</label>
                            <input type="date" class="form-control" id="petBirthdate">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="petGender" class="form-label">Пол</label>
                            <select class="form-select" id="petGender">
                                <option value="">Выберите пол</option>
                                <option value="male">Мужской</option>
                                <option value="female">Женский</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="petWeight" class="form-label">Вес (кг)</label>
                            <input type="number" step="0.1" class="form-control" id="petWeight">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="ownerSelect" class="form-label">Владелец</label>
                        <select class="form-select" id="ownerSelect" required>
                            <option value="">Выберите владельца</option>
                            <option value="1">Иван Петров</option>
                            <option value="2">Анна Сидорова</option>
                            <option value="3">Мария Иванова</option>
                            <option value="4">Алексей Смирнов</option>
                            <option value="new">+ Добавить нового владельца</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="petPhoto" class="form-label">Фотография</label>
                        <input type="file" class="form-control" id="petPhoto">
                    </div>
                    <div class="mb-3">
                        <label for="petNotes" class="form-label">Примечания</label>
                        <textarea class="form-control" id="petNotes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                <button type="button" class="btn btn-primary" id="savePatient">Сохранить</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Переключение между табличным и сеточным видом
        const viewTable = document.getElementById('viewTable');
        const viewGrid = document.getElementById('viewGrid');
        const tableView = document.getElementById('tableView');
        const gridView = document.getElementById('gridView');
        
        viewTable.addEventListener('click', function() {
            tableView.style.display = '';
            gridView.style.display = 'none';
            viewTable.classList.add('active');
            viewGrid.classList.remove('active');
        });
        
        viewGrid.addEventListener('click', function() {
            tableView.style.display = 'none';
            gridView.style.display = '';
            viewTable.classList.remove('active');
            viewGrid.classList.add('active');
        });
        
        // Обработчик формы фильтров
        const filterForm = document.getElementById('filterForm');
        filterForm.addEventListener('submit', function(e) {
            e.preventDefault();
            // Здесь будет логика фильтрации
            console.log('Фильтры применены');
        });
        
        // Обработчик сохранения пациента
        const savePatientBtn = document.getElementById('savePatient');
        savePatientBtn.addEventListener('click', function() {
            // Здесь будет логика сохранения пациента
            console.log('Пациент сохранен');
            
            // Закрыть модальное окно
            const modal = bootstrap.Modal.getInstance(document.getElementById('patientModal'));
            modal.hide();
            
            // Показать уведомление об успешном сохранении
            alert('Пациент успешно добавлен!');
        });
    });
</script>
{% endblock %}
